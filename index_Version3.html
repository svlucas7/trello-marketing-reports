<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trello Marketing Reports - Dashboard Profissional</title>
    <meta name="description" content="Ferramenta profissional para geração de relatórios de marketing a partir de dados do Trello">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #7c3aed;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--gray-50);
            color: var(--gray-700);
            line-height: 1.6;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 2rem 0;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.125rem;
            opacity: 0.9;
        }

        /* Main Content */
        .main { padding: 3rem 0; }

        .card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            margin-bottom: 2rem;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 1.5rem;
        }

        .section-title i { color: var(--primary); }

        /* Import Section */
        .import-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--gray-50);
            border-radius: 8px;
            border: 1px solid var(--gray-200);
        }

        .step-number {
            width: 36px;
            height: 36px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }

        .date-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .filter-group label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .date-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            font-size: 1rem;
        }

        .json-textarea {
            width: 100%;
            height: 200px;
            padding: 1rem;
            border: 2px dashed var(--gray-300);
            border-radius: 8px;
            font-family: 'Fira Code', monospace;
            font-size: 0.875rem;
            background: var(--gray-50);
            resize: vertical;
        }

        .json-textarea:focus {
            outline: none;
            border-color: var(--primary);
            border-style: solid;
            background: white;
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1rem;
        }

        .btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-secondary {
            background: white;
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }

        .btn:hover { transform: translateY(-2px); }

        /* Dashboard */
        .dashboard { display: none; }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .kpi-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            border-top: 4px solid var(--primary);
            text-align: center;
        }

        .kpi-card.success { border-top-color: var(--success); }
        .kpi-card.warning { border-top-color: var(--warning); }
        .kpi-card.danger { border-top-color: var(--danger); }

        .kpi-value {
            font-size: 3rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 0.5rem;
        }

        .kpi-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-600);
            text-transform: uppercase;
        }

        /* Table */
        .table-wrapper {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }

        .table th {
            background: var(--gray-50);
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.875rem;
        }

        .table tr:hover { background: var(--gray-50); }

        .status {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status.concluida {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .status.andamento {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .status.atrasada {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        /* Export */
        .export-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .export-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            padding: 1.5rem;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            color: inherit;
        }

        .export-btn:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .export-btn i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .export-btn.pdf { border-color: var(--danger); }
        .export-btn.pdf i { color: var(--danger); }

        .export-btn.excel { border-color: var(--success); }
        .export-btn.excel i { color: var(--success); }

        /* Toast */
        .toast {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: white;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: var(--shadow-lg);
            border-left: 4px solid var(--success);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s;
        }

        .toast.show { transform: translateX(0); }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 0.75rem; }
            .header h1 { font-size: 2rem; }
            .kpi-grid { grid-template-columns: 1fr; }
            .date-filters { grid-template-columns: 1fr; }
            .btn-group { flex-direction: column; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1><i class="fas fa-chart-line"></i> Marketing Reports</h1>
            <p>Dashboard Profissional para Relatórios do Trello</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Import Section -->
            <section class="card">
                <h2 class="section-title">
                    <i class="fas fa-upload"></i>
                    Importar Dados do Trello
                </h2>

                <div class="import-steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <div>
                            <h3>Exportar do Trello</h3>
                            <p>Menu → Mais → Exportar JSON</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <div>
                            <h3>Definir Período</h3>
                            <p>Escolha as datas do relatório</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <div>
                            <h3>Colar e Processar</h3>
                            <p>Cole o JSON e gere o relatório</p>
                        </div>
                    </div>
                </div>

                <div class="date-filters">
                    <div class="filter-group">
                        <label><i class="fas fa-calendar"></i> Data de Início</label>
                        <input type="date" id="startDate" class="date-input" value="2024-06-02">
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-calendar"></i> Data de Fim</label>
                        <input type="date" id="endDate" class="date-input">
                    </div>
                </div>

                <textarea 
                    id="jsonInput" 
                    class="json-textarea"
                    placeholder="Cole aqui o JSON exportado do Trello...

Exemplo:
{
  &quot;id&quot;: &quot;...&quot;,
  &quot;name&quot;: &quot;Meu Quadro&quot;,
  &quot;cards&quot;: [...],
  &quot;lists&quot;: [...],
  &quot;members&quot;: [...]
}"
                ></textarea>

                <div class="btn-group">
                    <button id="clearInput" class="btn btn-secondary">
                        <i class="fas fa-trash"></i> Limpar
                    </button>
                    <button id="processData" class="btn btn-primary">
                        <i class="fas fa-magic"></i> Gerar Relatório
                    </button>
                </div>
            </section>

            <!-- Dashboard Section -->
            <section id="dashboardSection" class="dashboard">
                <!-- KPI Cards -->
                <div class="card">
                    <h2 class="section-title">
                        <i class="fas fa-chart-bar"></i>
                        Dashboard de Resultados
                    </h2>
                    <p id="reportPeriod" style="margin-bottom: 2rem; color: var(--gray-600);"></p>

                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-value" id="totalTasks">0</div>
                            <div class="kpi-label">Total de Tarefas</div>
                        </div>
                        <div class="kpi-card success">
                            <div class="kpi-value" id="completedTasks">0</div>
                            <div class="kpi-label">Concluídas</div>
                        </div>
                        <div class="kpi-card warning">
                            <div class="kpi-value" id="inProgressTasks">0</div>
                            <div class="kpi-label">Em Andamento</div>
                        </div>
                        <div class="kpi-card danger">
                            <div class="kpi-value" id="overdueTasks">0</div>
                            <div class="kpi-label">Atrasadas</div>
                        </div>
                    </div>
                </div>

                <!-- Tasks Table -->
                <div class="card">
                    <h3 class="section-title">
                        <i class="fas fa-list"></i>
                        Relatório Detalhado
                    </h3>
                    
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Colaborador</th>
                                    <th>Tarefa</th>
                                    <th>Data Prevista</th>
                                    <th>Status</th>
                                    <th>Dias em Atraso</th>
                                    <th>Observações</th>
                                </tr>
                            </thead>
                            <tbody id="tasksTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Export Section -->
                <div class="card">
                    <h3 class="section-title">
                        <i class="fas fa-download"></i>
                        Exportar Relatório
                    </h3>
                    
                    <div class="export-grid">
                        <button id="exportPDF" class="export-btn pdf">
                            <i class="fas fa-file-pdf"></i>
                            <span>PDF</span>
                            <small>Relatório formatado</small>
                        </button>
                        <button id="exportExcel" class="export-btn excel">
                            <i class="fas fa-file-excel"></i>
                            <span>Excel</span>
                            <small>Planilha detalhada</small>
                        </button>
                        <button id="copyReport" class="export-btn">
                            <i class="fas fa-copy"></i>
                            <span>Copiar</span>
                            <small>Para email/WhatsApp</small>
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Toast -->
    <div id="toast" class="toast">
        <div id="toastMessage"></div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        let processedData = {};
        
        // Set end date to today
        document.getElementById('endDate').value = new Date().toISOString().split('T')[0];

        // Event listeners
        document.getElementById('clearInput').addEventListener('click', () => {
            document.getElementById('jsonInput').value = '';
        });

        document.getElementById('processData').addEventListener('click', processJSON);
        document.getElementById('exportPDF').addEventListener('click', exportToPDF);
        document.getElementById('exportExcel').addEventListener('click', exportToExcel);
        document.getElementById('copyReport').addEventListener('click', copyToClipboard);

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.style.borderLeftColor = type === 'success' ? 'var(--success)' : 'var(--danger)';
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function processJSON() {
            const jsonInput = document.getElementById('jsonInput').value.trim();
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            
            if (!jsonInput) {
                showToast('Por favor, cole o JSON do Trello primeiro!', 'error');
                return;
            }
            
            try {
                const trelloData = JSON.parse(jsonInput);
                processedData = analyzeTrelloData(trelloData, startDate, endDate);
                displayReport();
                showToast('Relatório gerado com sucesso!');
            } catch (error) {
                showToast('Erro ao processar JSON. Verifique o formato.', 'error');
                console.error(error);
            }
        }

        function analyzeTrelloData(data, startDate, endDate) {
            const tasks = [];
            const lists = {};
            
            // Map lists
            data.lists.forEach(list => {
                lists[list.id] = list.name;
            });
            
            // Process cards
            data.cards.forEach(card => {
                if (card.closed) return;
                
                const listName = lists[card.idList] || 'Desconhecida';
                const dueDate = card.due ? new Date(card.due) : null;
                const members = card.idMembers.map(memberId => {
                    const member = data.members.find(m => m.id === memberId);
                    return member ? member.fullName : 'Não atribuído';
                });
                
                // Determine status
                let status = 'andamento';
                if (listName.toLowerCase().includes('concluí') || 
                    listName.toLowerCase().includes('feito') || 
                    listName.toLowerCase().includes('done')) {
                    status = 'concluida';
                } else if (dueDate && dueDate < new Date()) {
                    status = 'atrasada';
                }
                
                // Calculate days late
                let daysLate = 0;
                if (status === 'atrasada' && dueDate) {
                    const today = new Date();
                    daysLate = Math.ceil((today - dueDate) / (1000 * 60 * 60 * 24));
                }
                
                const cardCreated = new Date(card.dateLastActivity);
                if (cardCreated >= startDate && cardCreated <= endDate) {
                    tasks.push({
                        name: card.name,
                        members: members.length > 0 ? members : ['Não atribuído'],
                        dueDate: dueDate,
                        status: status,
                        daysLate: daysLate,
                        description: card.desc || ''
                    });
                }
            });
            
            return {
                tasks: tasks,
                startDate: startDate,
                endDate: endDate,
                summary: calculateSummary(tasks)
            };
        }

        function calculateSummary(tasks) {
            return {
                total: tasks.length,
                completed: tasks.filter(t => t.status === 'concluida').length,
                inProgress: tasks.filter(t => t.status === 'andamento').length,
                overdue: tasks.filter(t => t.status === 'atrasada').length
            };
        }

        function displayReport() {
            document.getElementById('dashboardSection').style.display = 'block';
            document.getElementById('dashboardSection').scrollIntoView({ behavior: 'smooth' });
            
            // Update period
            const startStr = processedData.startDate.toLocaleDateString('pt-BR');
            const endStr = processedData.endDate.toLocaleDateString('pt-BR');
            document.getElementById('reportPeriod').textContent = `Período: ${startStr} - ${endStr}`;
            
            // Update KPIs
            const summary = processedData.summary;
            document.getElementById('totalTasks').textContent = summary.total;
            document.getElementById('completedTasks').textContent = summary.completed;
            document.getElementById('inProgressTasks').textContent = summary.inProgress;
            document.getElementById('overdueTasks').textContent = summary.overdue;
            
            // Update table
            updateTasksTable();
        }

        function updateTasksTable() {
            const tbody = document.getElementById('tasksTableBody');
            tbody.innerHTML = '';
            
            processedData.tasks.forEach(task => {
                const row = document.createElement('tr');
                
                const statusClass = task.status;
                const statusText = {
                    'concluida': 'Concluída',
                    'andamento': 'Em Andamento',
                    'atrasada': 'Atrasada'
                }[task.status];
                
                const dueDateStr = task.dueDate ? task.dueDate.toLocaleDateString('pt-BR') : 'Não definida';
                const daysLateStr = task.daysLate > 0 ? `${task.daysLate} dias` : '-';
                
                row.innerHTML = `
                    <td>${task.members.join(', ')}</td>
                    <td>${task.name}</td>
                    <td>${dueDateStr}</td>
                    <td><span class="status ${statusClass}">${statusText}</span></td>
                    <td style="color: ${task.daysLate > 0 ? 'var(--danger)' : 'inherit'}; font-weight: ${task.daysLate > 0 ? '600' : 'normal'};">${daysLateStr}</td>
                    <td>${task.description.substring(0, 50)}${task.description.length > 50 ? '...' : ''}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFont('helvetica');
            
            // Title
            doc.setFontSize(16);
            doc.text('Relatório de Tarefas - Equipe de Marketing', 20, 20);
            
            // Period
            const startStr = processedData.startDate.toLocaleDateString('pt-BR');
            const endStr = processedData.endDate.toLocaleDateString('pt-BR');
            doc.setFontSize(12);
            doc.text(`Período: ${startStr} - ${endStr}`, 20, 35);
            
            // Summary
            doc.setFontSize(14);
            doc.text('Resumo:', 20, 50);
            doc.setFontSize(10);
            const summary = processedData.summary;
            doc.text(`Total de Tarefas: ${summary.total}`, 20, 60);
            doc.text(`Tarefas Concluídas: ${summary.completed}`, 20, 70);
            doc.text(`Tarefas em Andamento: ${summary.inProgress}`, 20, 80);
            doc.text(`Tarefas Atrasadas: ${summary.overdue}`, 20, 90);
            
            doc.save(`relatorio-tarefas-${startStr.replace(/\//g, '-')}.pdf`);
            showToast('PDF exportado com sucesso!');
        }

        function exportToExcel() {
            const wb = XLSX.utils.book_new();
            
            const wsData = [
                ['Relatório de Tarefas - Equipe de Marketing'],
                [`Período: ${processedData.startDate.toLocaleDateString('pt-BR')} - ${processedData.endDate.toLocaleDateString('pt-BR')}`],
                [],
                ['RESUMO'],
                ['Total de Tarefas', processedData.summary.total],
                ['Tarefas Concluídas', processedData.summary.completed],
                ['Tarefas em Andamento', processedData.summary.inProgress],
                ['Tarefas Atrasadas', processedData.summary.overdue],
                [],
                ['DETALHAMENTO'],
                ['Colaborador', 'Nome da Tarefa', 'Data Prevista', 'Status', 'Dias em Atraso', 'Observações']
            ];
            
            processedData.tasks.forEach(task => {
                const statusText = {
                    'concluida': 'Concluída',
                    'andamento': 'Em Andamento',
                    'atrasada': 'Atrasada'
                }[task.status];
                
                wsData.push([
                    task.members.join(', '),
                    task.name,
                    task.dueDate ? task.dueDate.toLocaleDateString('pt-BR') : 'Não definida',
                    statusText,
                    task.daysLate > 0 ? `${task.daysLate} dias` : '-',
                    task.description
                ]);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            XLSX.utils.book_append_sheet(wb, ws, 'Relatório');
            
            const startStr = processedData.startDate.toLocaleDateString('pt-BR').replace(/\//g, '-');
            XLSX.writeFile(wb, `relatorio-tarefas-${startStr}.xlsx`);
            showToast('Excel exportado com sucesso!');
        }

        function copyToClipboard() {
            const startStr = processedData.startDate.toLocaleDateString('pt-BR');
            const endStr = processedData.endDate.toLocaleDateString('pt-BR');
            const summary = processedData.summary;
            
            let report = `RELATÓRIO DE TAREFAS - EQUIPE DE MARKETING\n`;
            report += `Período: ${startStr} - ${endStr}\n\n`;
            report += `RESUMO:\n`;
            report += `Total de Tarefas: ${summary.total}\n`;
            report += `Tarefas Concluídas: ${summary.completed}\n`;
            report += `Tarefas em Andamento: ${summary.inProgress}\n`;
            report += `Tarefas Atrasadas: ${summary.overdue}\n\n`;
            report += `DETALHAMENTO:\n`;
            
            processedData.tasks.forEach(task => {
                const statusText = {
                    'concluida': 'Concluída',
                    'andamento': 'Em Andamento',
                    'atrasada': 'Atrasada'
                }[task.status];
                
                report += `\n• ${task.name}\n`;
                report += `  Responsável: ${task.members.join(', ')}\n`;
                report += `  Data Prevista: ${task.dueDate ? task.dueDate.toLocaleDateString('pt-BR') : 'Não definida'}\n`;
                report += `  Status: ${statusText}\n`;
                if (task.daysLate > 0) {
                    report += `  Dias em Atraso: ${task.daysLate} dias\n`;
                }
                if (task.description) {
                    report += `  Observações: ${task.description}\n`;
                }
            });
            
            navigator.clipboard.writeText(report).then(() => {
                showToast('Relatório copiado para a área de transferência!');
            });
        }
    </script>
</body>
</html>